# 非参数检验方法

*非参数检验方法介绍* 

*https://www.cnblogs.com/hdu-zsk/p/6293721.html*

*https://blog.csdn.net/Anakin6174/article/details/84331303*

*http://rvdsd.top/page/13/*



***Python实现假设检验：***

 ***https://zhuanlan.zhihu.com/p/351075744***

***https://jishuin.proginn.com/p/763bfbd329a3***



```
显著性检验是用于检测科学实验中实验组与对照组之间是否有差异以及差异是否显著的办法。
所谓统计假设检验就是事先对总体（随机变量）的参数或总体分布形式做出一个假设，然后利用样本信息来判断这个假设是否合理。
而把只限定第一类错误概率的统计假设检验就称之为显著性检验。
```

```
显著性检验可以分为参数检验和非参数检验。
参数检验要求样本来源于正态总体（服从正态分布），且这些正态总体拥有相同的方差，在这样的基本假定（正态性假定和方差齐性假定）下检验各总体均值是否相等，属于参数检验。
当数据不满足正态性和方差齐性假定时，参数检验可能会给出错误的答案，此时应采用基于秩的非参数检验。
```

## 1. 概念

### 1.1 秩

```
非参数检验中的秩(rank)是最常用的概念，秩就是该数据按照升序排列后，每个观测值的位置。
```

### 1.2 非参数检验的原理

```
如果零假设中确定了一个中位数[Math Processing Error]，那么样本点应该以同样的概率出现在[Math Processing Error]的两边，也就是说，如果每个样本点减去零假设的中位数，那么得到的差值有些为正，有些为负，如果零假设正确，那么正负符号数目应该差不多，如果差得很多，这就意味着零假设有问题，可以拒绝零假设。这也就是所谓的符号检验(sign test)。
```

```
这里没有涉及任何总体分布，在零假设下，样本点和[Math Processing Error]的差值中负号的个数应该服从二项分布Bin(n,α)，而正号的个数则服从二项分布Bin(n,1-α)，注意，对于已知对称的分布，由于中位数和均值相等，对中位数的检验等同于对均值的检验，我们通过一个例子来解释符号检验。
```



## 2. Kruskal-Wallis H检验

```
Kruskal-Wallis H检验是基于秩次的非参数检验方法，用于检验多组间(也可以是两组)连续或有序分类变量是否存在差异。
```

```
使用Kruskal-Wallis H检验，需要满足4个条件。

条件1：有一个观察变量和一个分组变量。(eg. 胆管癌患者CA19-9水平为观察变量，肿瘤直径分组为分组变量，该条件满足。)

条件2：观察变量为非正态分布或方差不齐的连续变量或有序分类变量。该条件需通过软件分析进行判断。

条件3：存在多个分组(k≥2)。

条件4：具有相互独立的观测值。
```

```python
'''
用于检验两个及以上独立样本的分布是否相同。Kruskal-Wallis 检验是单因素方差分析检验的非参数检验版本，可以用来确定两个以上的独立样本是否有不同的分布，可以被认为是Mann-Whitney U检验的一般化。该检验的零假设H0是“所有样本数据从同一个分布中抽取的”，若拒绝原假设，则表明有足够证据证明至少有一个样本与其他样本不同，但是该假设并不能确定具体是哪几个不同。因此，如果需要确定，可再使用Mann-Whitney检验进行两两对比。

使用前提：各样本观察值为独立同分布的，各样本集中数据可定序。

原假设H0：各样本集的分布相同。
备择假设H1：至少有一个样本集与其他样本不同。
'''
from scipy.stats import kruskal
data1 = [0.873, 2.817, 0.121, -0.945, -0.055, -1.436, 0.360, -1.478, -1.637, -1.869]
data2 = [1.142, -0.432, -0.938, -0.729, -0.846, -0.157, 0.500, 1.183, -1.075, -0.169]
data3 = [-0.208, 0.696, 0.928, -1.148, -0.213, 0.229, 0.137, 0.269, -0.870, -1.204]
stat, p = kruskal(data1, data2, data3)
print('stat=%.3f, p=%.3f' % (stat, p))
if p > 0.05:
    print('不能拒绝原假设，样本集分布相同')
else:
    print('拒绝原假设，样本集分布可能不同')

'''output
stat=0.854, p=0.652
不能拒绝原假设，样本集分布相同
'''
```

## 3. Mann-Whitney U检验

```
判断两组数据是否存在差异可以使用两独立样本t检验或Mann-Whitney U检验。
若数据满足正态性和方差齐性，可使用两独立样本t检验；
若满足正态性、不满足方差齐性，可使用校正t检验(Welch’s t检验)；
若数据的方差相差太大，最好使用非参数检验(Mann-Whitney U检验)；
若数据正态性和方差齐性都不满足，最好使用非参数检验(Mann-Whitney U检验)。
```

```
Mann-Whitney U检验主要用于检验两组样本是否来自同一总体，也等价于判断两组样本是否存在差异.
Mann-Whitney U检验思想与Wilcoxon带符号的等级检验类似，不同之处在于，其利用数据的大小顺序而不是正负号来判断两组数据的差异。它假设两个样本分别来自除了总体均值以外完全相同的两个总体，目的是检验这两个总体的均值是否有显著的差别。
```

```
使用Mann-Whitney U检验，需要满足3个条件：

条件1：有一个观察变量，且观察变量为连续变量(不满足正态分布或方差严重不齐)或等级变量。该条件需要通过软件判断或专业判断。

条件2：有一个分组变量，且为二分类。

条件3：具有相互独立的观测值。
```

```
步骤：
1. 从两个总体A和B中随机抽取容量为nA和nB的两个独立随机样本，将(nA + nB)个观察值按大小顺序排列，指定1为最小(或最大)观察值，指定2为第二个最小(或第二个最大)的观察值，依此类推。如果存在相同的观察值，则用它们位序的平均数。
2. 计算两个样本的等级和TA和TB。
3. 根据TA和TB即可给出 Mann-Whitney U检验的公式。计算得到的两个U值不相等，但是它们的和总是等于nAnB，即有UA + UB = nAnB。若 n_A\le 20 、 n_B\le 20 时，则其检验统计量为：
UA = nAnB + nA(nA + 1) / 2 − TA
UB = nAnB + nB(nB + 1) / 2 − TB
在检验时，因为 Mann-Whitney U检验的临界值表只给出了较小的临界值，所以用UA、UB中较小的U值作为检验统计量。
4. 选择其中较小U值与U的临界值比较，若U大于Uα，接受原假设H0，若U小于Uα则拒绝H0，接受H1。接受域与威尔科克森检验相同。U检验也有小样本和大样本之分，在小样本时，U的临界值均已编制成表。在大样本时，U的分布趋近正态分布，因此可用正态逼近处理。
```

```python
'''
用于检验两独立样本分布是否相同。该检验的原理是，将两样本集合并起来，一起排序，然后计算两样本的值是随机混合排序的，还是聚集的。秩序随机则代表两样本集分布无差异，而出现样本值聚集情况则表明有差异。为了使检验有效，要求每个样本数据至少有20个观测值。

使用前提：各样本观察值为独立同分布的，各样本集中数据可定序。

原假设H0：两样本集分布相同。
'''
from scipy.stats import mannwhitneyu
data1 = [0.873, 2.817, 0.121, -0.945, -0.055, -1.436, 0.360, -1.478, -1.637, -1.869]
data2 = [1.142, -0.432, -0.938, -0.729, -0.846, -0.157, 0.500, 1.183, -1.075, -0.169,]
stat, p = mannwhitneyu(data1, data2)
print('stat=%.3f, p=%.3f' % (stat, p))
if p > 0.05:
    print('不能拒绝原假设，两样本集分布相同')
else:
    print('拒绝原假设，样本集分布可能不同')

'''output
stat=40.000, p=0.236
不能拒绝原假设，两样本集分布相同
'''
```

## 4. Wilcoxon 符号秩检验

```
Wilcoxon 符号秩检验(Wilcoxon signed-rank test) 用来比较两个相关的样本，配对样本，或一个样本的重复测量，检验是否它们的总体均值秩改变。
```

```
Wilcoxon符号秩检验的原理是这样的：
假定x1,x2,⋯,xn为来自连续对称总体的一个样本，如果我们的假设检验问题的零假设为中位数（均值）M=M0。那么，
①对于符号检验而言，只需计算xi−M0(i=1,2,⋯,n)中有多少正负符号，即可利用二项分布的概率来计算p值。
②但对于Wilcoxon符号秩检验，则要把|xi−M0|排序，得到|xi−M0|的秩。然后把xi−M0的符号加到相应的秩上面。于是，就可以得到既带有正号的秩，又带有负号的秩，对带负号的秩的绝对值求和，即把满足xi−M0<0的|xi−M0|的秩求和，并用W-表示，同理得到W+。如果M0的确是中位娄和，那么W−和W+应该大体上差不多。如果W−或者W+过大或过小，则应该怀疑中位数M=M0的零假设。令W=min(W−,W+)，则当W太小时，应该拒绝零假设。这个W就是Wilcoxon符号秩检验统计量。
```

```python
'''
用于检验两配对样本分布是否相同。样本不独立，因此不能使用Mann-Whitney U检验，而是使用Wilcoxon符号秩检验。这相当于配对样本的学生t检验，但是适用于定序数据，而不是服从正态分布的实测数据。

使用前提：各样本观察值为独立同分布的，各样本集中数据可定序，样本的数据是一一对应的关系，与Mannwhitney不同的是，该检验需要样本数量相同，即配对。

原假设H0：两样本集分布相同。
'''
from scipy.stats import wilcoxon
data1 = [0.873, 2.817, 0.121, -0.945, -0.055, -1.436, 0.360, -1.478, -1.637, -1.869]
data2 = [1.142, -0.432, -0.938, -0.729, -0.846, -0.157, 0.500, 1.183, -1.075, -0.169,]
stat, p = wilcoxon(data1, data2)
print('stat=%.3f, p=%.3f' % (stat, p))
if p > 0.05:
    print('不能拒绝原假设，两样本集分布相同')
else:
    print('拒绝原假设，样本集分布可能不同')

''' output
stat=21.000, p=0.557
不能拒绝原假设，两样本集分布相同
'''
```



## 其他

```
1. 两独立样本资料的非参数检验，既可以采用Wilcoxon秩和检验，也可以采用Kruskal-Wallis H检验，两者检验结论一致。
2. 对于参数检验，两两比较的方法有Tukey法、Scheffe法、Bonferroni法、Dunnett法等。而对于非参数检验，如Kruskal-Wallis H检验，两两比较通常可采用DSCF(Dwass-Steel-Critchlow-Fligner)法，但在Medcalc软件中默认使用的是Conover法。
3. 对于多组定量资料比较，在符合正态性和方差齐性的条件下，首选使用单因素方差分析。若不是特别严重的方差不齐，可使用单因素方差分析的校正检验方法(Welch one-way ANOVA/ Welch’s F检验)；若组间方差差异较大时，建议使用非参数检验(Kruskal-Wallis H检验)；若正态性和方差齐性都不满足，最好使用非参数检验(Kruskal-Wallis H检验)。
```

